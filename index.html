<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Suivi d'heures - Doktor Jack (Travail de nuit)</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0; }
    header { background:#222; color:white; padding:1rem; text-align:center; }
    .container { max-width:800px; margin:2rem auto; background:white; padding:2rem; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
    label { display:block; margin-top:1rem; }
    input, button { padding:0.5rem; margin-top:0.5rem; width:100%; }
    table { width:100%; margin-top:2rem; border-collapse:collapse; }
    th, td { border:1px solid #ccc; padding:0.5rem; text-align:center; }
    th { background:#eee; }
    .bilan { margin-top:2rem; padding:1rem; background:#fafafa; border:1px solid #ddd; }
  </style>
</head>
<body>
  <header>
    <h1>⛓️ Doktor Jack - Suivi d'heures (Nuit)</h1>
  </header>
  <div class="container">
    <h2>Ajouter une prestation</h2>
    <form id="timeForm">
      <label for="date">Date (jour de début) :</label>
      <input type="date" id="date" required>
      <label for="start">Heure de début (soir) :</label>
      <input type="time" id="start" required>
      <label for="end">Heure de fin (lendemain matin) :</label>
      <input type="time" id="end" required>
      <button type="submit">Enregistrer</button>
    </form>

    <h2>Historique</h2>
    <table id="recordsTable">
      <thead>
        <tr>
          <th>Date (soir)</th>
          <th>Début</th>
          <th>Fin (lendemain)</th>
          <th>Heures</th>
          <th>Salaire (€)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="bilan">
      <h3>Bilan du mois</h3>
      <p>Total heures : <span id="totalHours">0</span></p>
      <p>Total salaire : <span id="totalSalary">0</span> €</p>
    </div>
  </div>

  <script>
    const form = document.getElementById('timeForm');
    const tbody = document.querySelector('#recordsTable tbody');
    const totalHoursEl = document.getElementById('totalHours');
    const totalSalaryEl = document.getElementById('totalSalary');
    const rate = 12; // € par heure

    function loadData() {
      return JSON.parse(localStorage.getItem('records') || '[]');
    }

    function saveData(data) {
      localStorage.setItem('records', JSON.stringify(data));
    }

    function renderTable() {
      const data = loadData();
      tbody.innerHTML = '';
      let totalHours = 0;
      data.forEach(record => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${record.date}</td><td>${record.start}</td><td>${record.end}</td><td>${record.hours}</td><td>${record.salary}</td>`;
        tbody.appendChild(tr);
        totalHours += record.hours;
      });
      totalHoursEl.textContent = totalHours.toFixed(2);
      totalSalaryEl.textContent = (totalHours * rate).toFixed(2);
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const date = document.getElementById('date').value;
      const start = document.getElementById('start').value;
      const end = document.getElementById('end').value;

      const startDate = new Date(date + 'T' + start);
      let endDate = new Date(date + 'T' + end);

      // Si l'heure de fin est inférieure à l'heure de début, c'est le lendemain matin
      if (endDate <= startDate) {
        endDate.setDate(endDate.getDate() + 1);
      }

      const diff = (endDate - startDate) / 1000 / 3600;
      if (diff <= 0) {
        alert('Les heures sont invalides.');
        return;
      }
      const salary = diff * rate;
      const record = { date, start, end, hours: diff, salary: salary.toFixed(2) };
      const data = loadData();
      data.push(record);
      saveData(data);
      renderTable();
      form.reset();
    });

    renderTable();
  </script>
</body>
</html>